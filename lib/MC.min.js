const mc_context_global=new Set,anonim_render_global=new Set,mc_state_global=new Set;!function(){var t=window.$;window.$=function(){if(arguments[0].prototype instanceof MC){if(MCEngine.active){const t=MCEngine.renderChilds_Component(...arguments);if("nt%Rnd#el"!==t)return t}return"string"==typeof arguments[1]?MC.keys.some((t=>t===arguments[1]))&&console.error(`[MC] Обнаружено повторение ключа "${arguments[1]}" для компонента ${arguments[0].name}`):MC.keys.some((t=>t===arguments[2]))&&console.error(`[MC] Обнаружено повторение ключа "${arguments[2]}" для компонента ${arguments[0].name}`),new MC_Component(new MC_Component_Registration(arguments))}const[e,n,o]=arguments;if("function"==typeof e){if(MCEngine.active){const t=MCEngine.renderChilds_FC(o,e);if("nt%Rnd#el"!==t)return t}if(o){const t=MC.uuidv4(),[r,l]=o.createVirtual_FC(e,t),c=[];n&&n.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(r),c.push(t.value)):console.warn("Не стейт")}));const a=e(c);if(!a){const t=document.createElement("micro_component");try{t.setAttribute("style","height: 0; width: 0; display: none;"),t.setAttribute("mc",o.id)}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return l.controller=n,l.HTMLElement=t,t}try{a[0].setAttribute("mc",o.id)}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return l.controller=n,l.HTMLElement=a[0],a[0]}{const t=e,o=n,r=MC.uuidv4(),[l,c]=MC.createAnonim_FC(t,r),a=[];o&&o.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(l),a.push(t.value)):console.warn("Не стейт")}));const s=t(a);if(!s){const t=document.createElement("micro_component");try{t.setAttribute("style","height: 0; width: 0; display: none;"),t.setAttribute("mc","anon")}catch(t){console.error("[MC] Попытка формирования элемента может закончится неудачей, возможно пытаетесь отдать под контроль элемент, который уже контролируется.")}return c.controller=o,c.HTMLElement=t,t}try{s[0].setAttribute("mc","anon")}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return c.controller=o,c.HTMLElement=s[0],s[0]}}return t.apply(this,arguments)}}();class MC{static keys=[];constructor(){if(MC._instance)return MC._instance}static anonimCollection=new Set;static createAnonim_FC(t,e){const n={Fn:t,parent_id:null,key:e};return MC.anonimCollection.add(n),[{context:null,id_element:e},n]}static createAnonimComponent(t,e,n){const o={component:t,parent_id:null,key:e,identifier:n};return MC.anonimCollection.add(o),[{context:null,id_element:e},o]}state(t,e){return MC.createLocallyState(t,e,this)}static Props(t){const e=[],n={props:null,context:null,states:[]};for(let o in t)!Array.isArray(t[o])&&t[o]instanceof MCcontext?(e[2]={context:t[o]},n.context=t[o]):Array.isArray(t[o])&&t[o].every((t=>t instanceof MCState))?(e[1]={states:t[o]},n.states=t[o]):(e[0]={props:t[o]},n.props=t[o]);return[e,n]}static uuidv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}static createState(t,e){const n={value:t,key:e,id:MC.uuidv4()},o=new MCState(n);return(new MCEngine).registrController(o),mc_state_global.add(o),o}static createLocallyState(t,e,n){const o={value:t,id:MC.uuidv4(),key:e},r=new MCState(o,n);return(new MCEngine).registrController(r),mc_state_global.add(r),r}static createContext(t){const e={id:MC.uuidv4(),key:t},n=new MCcontext(e);return mc_context_global.add(n),n}newKey(t){if(t){const e=[];for(let n=0;n<t;n++)e.push(MC.uuidv4());return e}return MC.uuidv4()}static getState(t){const e=[];return mc_state_global.forEach((n=>{n.key===t&&e.push(n)})),e}static getContext(){let t;return mc_context_global.forEach((e=>{e.id===id&&(t=e)})),t}}class MC_Component{constructor(t){return this.getComponent(t)}getComponent(t){return t}}class MC_Component_Registration{constructor(t){let[e,n,o]=t;"string"==typeof n&&(o=n,n=null);let r=n;return n||(r=[null,{context:null,props:null,states:null}]),MC.keys.push(o),this.register(e,r,o)}register(t,e,n){const[o,r]=e;if(r.context){const e=new t(r.props,r.context),o=[];mc_state_global.forEach((t=>{t.local&&t.local===e&&o.push(t)}));const l=MC.uuidv4(),[c,a]=r.context.createVirtual_Component(e,l,n),s=[];r.states&&r.states.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(c),s.push(t.value)):console.error("[MC] Ошибка обработки объекта контролёра.")}));const i=[];o&&o.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(c),i.push(t.value)):console.error("[MC] Ошибка обработки объекта контролёра.")})),a.props=r.props;const u=e.render({global:s,local:i},r.props,r.props);if(!u){const t=document.createElement("micro_component");try{t.setAttribute("style","height: 0; width: 0; display: none;"),t.setAttribute("mc",r.context.id)}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return a.controller={global:r.states,local:o},a.HTMLElement=t,t}let p=r.states?r.states:[],d=o||[];try{u[0].setAttribute("mc",r.context.id)}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return a.controller={global:p,local:d},a.HTMLElement=u[0],u[0]}{const e=new t(r.props,r.context),o=[];mc_state_global.forEach((t=>{t.local&&t.local===e&&o.push(t)}));const l=MC.uuidv4(),[c,a]=MC.createAnonimComponent(e,l,n),s=[];r.states&&r.states.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(c),s.push(t.value)):console.error("[MC] Ошибка обработки объекта контролёра.")}));const i=[];o&&o.map((t=>{"MCState"===t.__proto__.constructor.name?(t.virtualCollection.add(c),i.push(t.value)):console.error("[MC] Ошибка обработки объекта контролёра.")})),a.props=r.props;const u=e.render({global:s,local:i},r.props,r.props);if(!u){const t=document.createElement("micro_component");try{t.setAttribute("style","height: 0; width: 0; display: none;"),t.setAttribute("mc","anon")}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return a.controller={global:r.states,local:o},a.HTMLElement=t,t}let p=r.states?r.states:[],d=o||[];try{u[0].setAttribute("mc","anon")}catch(t){console.error("[MC] Попытка формирования элемента закончилась неудачно, возможно пытаетесь отдать под контроль элемент, который уже чем-то контролируется.")}return a.controller={global:p,local:d},a.HTMLElement=u[0],u[0]}}}class MCState{id;value;key;virtualCollection;passport;constructor(t,e){e&&(this.local=e);const{value:n,key:o,id:r}=t;this.value=n,this.key=o,this.id=r,this.virtualCollection=new Set}getPassport(t){this.passport=t}set(t){this.passport&&(this.value=t,this.passport.value=this.value)}get(){return this.value}}class MCEngine{state;static active=!1;constructor(){}handlerRender(t,e,n){let o={};n||(n="obj");return new Proxy(t,{get:(r,l)=>"object"!=typeof t[l]?t[l]:(void 0===o[l]&&(o[l]=this.handlerRender(t[l],e,`${n}.${l}`)),Reflect.get(...arguments)),set:(n,o,r)=>(e(this.state),t[o])})}render(t){if(0===t.virtualCollection.length)return null;MCEngine.active=!0,t.virtualCollection.forEach((t=>{if(!t.context)return MC.anonimCollection.forEach((e=>{if(e.key===t.id_element){let t;if(e.component){const n=[];e.controller.global.forEach((t=>{n.push(t.value)}));const o=[];e.controller.local.forEach((t=>{o.push(t.value)})),t=e.component.render({global:n,local:o},e.props)[0]}else{const n=[];e.controller.forEach((t=>{n.push(t.value)})),t=e.Fn(n)[0]}e.HTMLElement.replaceWith(t),e.HTMLElement=t}})),void(MCEngine.active=!1);mc_context_global.forEach((e=>{e.id===t.context&&e.virtualCollection.forEach((e=>{if(e.key===t.id_element){let t;if(e.component){const n=[];e.controller.global.forEach((t=>{n.push(t.value)}));const o=[];e.controller.local.forEach((t=>{o.push(t.value)})),t=e.component.render({global:n,local:o},e.props)[0]}else{const n=[];e.controller.forEach((t=>{n.push(t.value)})),t=e.Fn(n)[0]}e.HTMLElement.replaceWith(t),e.HTMLElement=t}}))}))})),MCEngine.active=!1}static renderChilds_FC(t,e){let n=null,o=!1;return t?(t.virtualCollection.forEach((r=>{if(!r.component&&r.Fn.toString()===e.toString()){o=!0;const e=[];r.controller.forEach((t=>{e.push(t.value)}));let l=r.Fn(e);l||(l=[],l[0]=document.createElement("micro_component"),l[0].setAttribute("style","height: 0; width: 0; display: none;"),l[0].setAttribute("mc",t.id)),r.HTMLElement=l[0],n=r.HTMLElement}})),o?n:"nt%Rnd#el"):(MC.anonimCollection.forEach((t=>{if(!t.component&&t.Fn.toString()===e.toString()){o=!0;const e=[];t.controller.forEach((t=>{e.push(t.value)}));let r=t.Fn(e);r||(r=[],r[0]=document.createElement("micro_component"),r[0].setAttribute("style","height: 0; width: 0; display: none;"),r[0].setAttribute("mc","anon")),t.HTMLElement=r[0],n=t.HTMLElement}})),o?n:"nt%Rnd#el")}static renderChilds_Component(t,e,n){if(!e)return console.error("[MC] Передайте при создании компонента его ключ! При отсутствии ключа, компонент может быть утерян!"),"nt%Rnd#el";"string"==typeof e&&(n=e);const[o,r]=e;let l=null,c=!1;return r.context?(r.context.virtualCollection.forEach((t=>{if(!t.Fn&&t.identifier===n){c=!0;const e=[];t.controller.global.forEach((t=>{e.push(t.value)}));const n=[];t.controller.local.forEach((t=>{n.push(t.value)}));let o=t.component.render({global:e,local:n},r.props,t.props);o||(o=[],o[0]=document.createElement("micro_component"),o[0].setAttribute("style","height: 0; width: 0; display: none;"),o[0].setAttribute("mc",context.id)),t.HTMLElement=o[0],l=t.HTMLElement}})),c?l:"nt%Rnd#el"):(MC.anonimCollection.forEach((t=>{if(!t.Fn&&t.identifier===n){c=!0;const e=[];t.controller.global.forEach((t=>{e.push(t.value)}));const n=[];t.controller.local.forEach((t=>{n.push(t.value)}));let o=t.component.render({global:e,local:n},r.props,t.props);o||(o=[],o[0]=document.createElement("micro_component"),o[0].setAttribute("style","height: 0; width: 0; display: none;"),o[0].setAttribute("mc","anon")),t.HTMLElement=o[0],l=t.HTMLElement}})),c?l:"nt%Rnd#el")}registrController(t){this.state=t;const e={value:t.id},n=this.handlerRender(e,this.render,"");t.getPassport(n)}}class MCcontext{id;key;virtualCollection;constructor(t){const{id:e,key:n}=t;this.id=e,this.key=n??null,this.virtualCollection=new Set}render(){this.virtualCollection}createVirtual_FC(t,e){const n={Fn:t,parent_id:this.id,key:e};return this.virtualCollection.add(n),[{context:this.id,id_element:e},n]}createVirtual_Component(t,e,n){const o={component:t,parent_id:this.id,key:e,identifier:n};return this.virtualCollection.add(o),[{context:this.id,id_element:e},o]}}